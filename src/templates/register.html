{% extends "base.html" %}
{% block title %}Register{% endblock %}
{% block content %}
<div class="max-w-lg mx-auto">
    <h1 class="text-3xl font-bold mb-6">Register as a Contractor</h1>

    {% if error %}
    <div class="bg-red-100 border border-red-300 text-red-800 px-4 py-3 rounded-lg mb-4">{{ error }}</div>
    {% endif %}

    <form method="post" class="bg-white rounded-xl p-8 shadow-sm border space-y-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Full Name *</label>
            <input name="name" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Business Name</label>
            <input name="business_name" class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Email *</label>
            <input name="email" type="email" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
            <input name="phone" class="w-full border rounded-lg px-3 py-2">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Trade *</label>
            <select name="trade" required class="w-full border rounded-lg px-3 py-2">
                {% for t in trades %}
                <option value="{{ t }}">{{ t|title }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">State *</label>
            <select name="state" id="state-select" required class="w-full border rounded-lg px-3 py-2">
                {% for code, name in states.items() %}
                <option value="{{ code }}">{{ name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="grid grid-cols-2 gap-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">City</label>
                <select name="city" id="city-select" class="w-full border rounded-lg px-3 py-2">
                    <option value="">Select...</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">County</label>
                <input name="county" class="w-full border rounded-lg px-3 py-2">
            </div>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1" id="license-label">License Number</label>
            <input name="license_number" id="license-input" class="w-full border rounded-lg px-3 py-2" placeholder="e.g. 2705081693">
            <p class="text-xs text-gray-400 mt-1" id="license-hint">VA: DPOR license number Â· NC: NCLBGC license number (without L. prefix)</p>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Password *</label>
            <input name="password" type="password" required class="w-full border rounded-lg px-3 py-2">
        </div>
        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 font-medium">
            Create Account
        </button>
    </form>
    <p class="text-center text-gray-500 text-sm mt-4">Already registered? <a href="/login" class="text-blue-600 hover:underline">Login</a></p>
</div>

<script>
const citiesByState = {{ cities_by_state | tojson }};
const stateSelect = document.getElementById('state-select');
const citySelect = document.getElementById('city-select');
const licenseInput = document.getElementById('license-input');

function updateCities() {
    const state = stateSelect.value;
    const cities = citiesByState[state] || [];
    citySelect.innerHTML = '<option value="">Select...</option>';
    cities.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c; opt.textContent = c;
        citySelect.appendChild(opt);
    });
    if (state === 'VA') {
        licenseInput.placeholder = 'e.g. 2705081693';
    } else if (state === 'NC') {
        licenseInput.placeholder = 'e.g. 83060';
    }
}
stateSelect.addEventListener('change', updateCities);
updateCities();
</script>
{% endblock %}
